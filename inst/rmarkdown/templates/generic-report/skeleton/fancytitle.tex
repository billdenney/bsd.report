%%% Allow the \blandscape and \elandscape commands to start and end landsape
%%% sections of the document.  (Note that any \blandscape must have a matching
%%% \elandscape.)
\usepackage{pdflscape}
\newcommand{\blandscape}{\begin{landscape}}
\newcommand{\elandscape}{\end{landscape}}

%%% Enable use of the TopicLongTable R package
\usepackage{topiclongtable}
%%% Enable the \FloatBarrier command, and default to keeping floats within
%%% the section defining the float.
\usepackage[section]{placeins}

\usepackage{currfile}
\usepackage{bookmark}

%%% Generate bookmarks for the table of contents, list of figures, and list of tables
\makeatletter
\pretocmd\tableofcontents{%
\pdfbookmark[0]{\contentsname}{toc}%
}
\makeatother

\makeatletter
\pretocmd\listoffigures{%
\pdfbookmark[0]{\listfigurename}{lof}%
}
\makeatother

\makeatletter
\pretocmd\listoftables{%
\pdfbookmark[0]{\listtablename}{lot}%
}
\makeatother

%%% Generate bookmarks for all figures
\makeatletter
\pretocmd\endfigure{%
\addtocontents{lof}{\protect{%
    \bookmark[
    rellevel=1,
    keeplevel,
    dest=\@currentHref,
    ]{Figure \thefigure: \@currentlabelname}}}%
\bookmark[
rellevel=1,
keeplevel,
dest=\@currentHref,
 ]{Figure \thefigure: \@currentlabelname}%
}{}{\errmessage{Patching \noexpand\endfigure failed}}
\makeatother

%%% Generate bookmarks for all tables
\makeatletter
\pretocmd\endtable{%
\addtocontents{lot}{\protect{%
    \bookmark[
    rellevel=1,
    keeplevel,
    dest=\@currentHref,
    ]{Table \thetable: \@currentlabelname}}}%
\bookmark[
rellevel=1,
keeplevel,
dest=\@currentHref,
 ]{Table \thetable: \@currentlabelname}%
}{}{\errmessage{Patching \noexpand\endtabular failed}}

\pretocmd\endlongtable{%
\addtocontents{lot}{\protect{%
    \bookmark[
    rellevel=1,
    keeplevel,
    dest=\@currentHref,
    ]{Table \thetable: \@currentlabelname}}}%
\bookmark[
rellevel=1,
keeplevel,
dest=\@currentHref,
 ]{Table \thetable: \@currentlabelname}%
}{}{\errmessage{Patching \noexpand\endtabular failed}}

\makeatother

\usepackage{fancyhdr}
\pagestyle{fancy}
\fancyhead{}
\fancyfoot{}
\ifdefined\sponsor
\fancyhead[L]{\sponsor}
\fi
\fancyhead[R]{Confidential}
\ifdefined\reportnumber
\fancyfoot[L]{\reportnumber}
\fancyfoot[C]{\reportstatus}
\fi
\fancyfoot[R]{\thepage}

\usepackage{listings}
\lstset{
  basicstyle=\ttfamily,
  columns=fullflexible,
  breaklines=true,
  postbreak=\mbox{\textcolor{red}{$\hookrightarrow$}\space},
}
% Allows \begin{lstlisting}\end{lstlisting} with pretty line wrapping

\makeatletter
\def\@maketitle{%
  \newpage
  \null
  \bookmark[level=0,keeplevel,dest=@currentHref]{Title Page}
  \begin{center}%
  \let \footnote \thanks
    {\LARGE \@title \par}%
    \vskip 2cm
  \end{center}%
  \begin{tabular}{ll}
  \ifdefined\sponsor
  Sponsor: & \sponsor \\
  \ifdefined\sponsoraddress
  Sponsor address: & \sponsoraddress \\
  \fi
  \fi
  Author:  & \@author \\
  Author Contact information: & \begin{minipage}[t]{0.5\columnwidth}Chief Scientist\par Human Predictions, LLC\par Cambridge, MA 02139\par United States\par wdenney@humanpredictions.com\end{minipage} \\
  Report Date: & \@date \\
  \ifdefined\reportnumber
  Report Number: & \reportnumber \\
  Report Status: & \reportstatus \\
  \fi
  \end{tabular}
  \vskip 1.5em
  \begin{center}%
  \let \footnote \thanks
    \vskip 1.5em
    \begin{tabular}[t]{ccl}%
    \textbf{Signature} & \textbf{Date} & \textbf{Role} \\
    \rule{0pt}{2cm} \rule{8cm}{0.4pt} & \rule{4cm}{0.4pt} & Author \\
    \@author & & \\
    \ifdefined\reviewername
    \rule{0pt}{2cm} \rule{8cm}{0.4pt} & \rule{4cm}{0.4pt} & Reviewer \\
    \reviewername & & \\
    \fi
    \ifdefined\approvername
    \rule{0pt}{2cm} \rule{8cm}{0.4pt} & \rule{4cm}{0.4pt} & Approver \\
    \approvername & & \\
    \fi
    \end{tabular}
  \end{center}
  \newpage}
\makeatother